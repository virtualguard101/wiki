---
date: 2025-11-11 09:55:39
title: 文件系统概述
permalink: 
publish: true
---

# 文件系统概述

## 文件的基本概念

**文件（File）**是以硬盘为载体的存储在计算机上的**信息集合**，可以是文本、图片、音频、视频、程序等。在Linux系统中，就有“万物皆文件”的理念。

在系统运行时，**计算机以进程为单位进行资源的调度和分配**；而**在用户的输入/输出中，则以文件为单位进行数据的传输**。

简单来说，前面我们所学的概念，绝大多数是面向系统的，而**文件系统**则是面向用户的。

当用户将文件用于程序的输入/输出时，还希望可以访问、修改和保存文件等，实现对文件的**管理**，这就需要操作系统一个管理系统实现这些，这就是**文件系统（File System）**的由来。

### 文件的定义

从自底向上的定义方式结构化地定义文件:

1. 数据项: 文件系统最低级的数据组织形式，可分为以下两种类型:

    - 基本数据项: 用于描述一个对象的某种属性的一个值，是数据中的最小逻辑单位

    - 组合数据项: 顾名思义，由多个基本数据项组合而成

2. 记录: 一组相关数据项的**集合**，**用于描述一个对象在某些方面的属性**

3. 文件: 由创建者所定义的、具有文件名的一组相关元素的集合，分为**有结构文件**和**无结构文件**两种:

    - 有结构文件: 由若干记录组成的数据序列

    - 无结构文件: 被视为**字符流**的文件，如二进制文件或字符文件

事实上，关于文件并没有严格的定义。在操作系统中，文件可以由任何形式的数据或程序组织而成，如数字、字符、二进制代码等。理论上，只要是计算机系统能够识别的数据流，都可以被组织成文件（这就不难理解为什么在 Linux 中“万物皆文件”的理念了）。

### 文件的属性

- 名称

- 类型

- 创建者

- 所有者

- 位置

- 大小

- 保护

- 操作时间戳

    - 创建时间

    - 最后一次修改时间

    - 最后一次访问时间

### 文件的分类

- 按性质和用途分类

    - 系统文件

    - 用户文件

    - 库文件

- 按文件中数据的形式分类

    - 源文件

    - 目标文件

    - 可执行文件

- 按存取控制属性分类

    - 可执行文件

    - 只读文件

    - 可读/写文件

- 按组织形式和处理方式分类

    - 普通文件

    - 目录文件

    - 特殊文件

## 文件控制块和索引节点

FCB或索引节点相当于图书馆中书籍的索书号，我们可在图书管理系统上查询到书籍的索书号，从而找到书籍实际存放的物理位置。

### 文件控制块

和进程一样，为了方便管理，引入一个**在磁盘中连续存储的数据结构**来存储控制文件所需的各种信息，即**文件控制块（File Control Block，FCB）**。

- 一个典型的文件控制块实现:

    | 文件名 |
    |:-----:|
    | 文件类型 |
    | 文件权限 |
    | 文件大小 |
    | 文件数据块指针 |

从抽象的角度来看，一个FCB主要包含以下信息:

- 基本信息: 文件名、文件的物理位置、文件的物理结构/逻辑结构等

- 存取控制信息: 文件所有者/核准用户/一般用户的存取权限

- 使用信息: 文件的建立时间、修改时间等

### 索引节点

前文提到的管理方式通常使用*文件名*作为文件检索的**唯一标识**，在这种方式下，查找目录需要连续不断地将磁盘中的用于存放目录的盘块调入内存进行逐一比较，直至找到为止。

在索引文件的过程中，我们仅用到了文件名，当且仅当文件名匹配时，才需要从存放该文件的目录项中读出文件的物理地址。文件的其他描述信息在这个过程中并没有用到，不需要调入内存。因此，可以采用**文件名和文件描述信息分离**的方式，使文件描述信息单独形成一个称为**索引节点**的数据结构，简称 $i$ 节点。

在这种模型中，文件目录中的每个目录项仅由文件名和相应的索引节点（或索引节点指针）构成:

| 文件名 | 索引节点编号/指针 |
|:-----:|:-----:|
| 文件名1 | ... |
| 文件名2 | ... |
| ... | ... |

#### 磁盘索引节点

存放在磁盘上的索引节点，称为**磁盘索引节点（Disk Index Node，DIN）**，主要包含以下信息:

- 文件主标识符: 拥有该文件的用户 ID

- 文件类型: 文件的类型，如普通文件、目录文件、特殊文件等

- 文件存取权限: 各类用户对该文件的存取权限

- 文件物理地址: 每个索引节点中包含13个地址项（iaddr(0) ~ iaddr(12)），以直接或间接的方式给出数据文件所在盘块的编号

- 文件长度: 文件的大小，以字节为单位

- 文件链接计数: 该文件系统中指向该文件的文件名数目

- 文件存取时间: 文件的最近访问时间、创建时间、索引节点最近被修改的时间

#### 内存索引节点

文件被打开时，要将磁盘索引节点复制到内存的索引节点**内存索引节点（Memory Index Node，MIN）**上。

MIN在DIN的基础上新增以下信息:

- 索引节点号: 用于标识内存索引节点

- 状态: 指示节点是否上[锁](2-sync-mutex.md#互斥锁)或被修改

- 访问计数: 记录该节点被进程访问的次数

- 逻辑设备号: 文件所属文件系统的逻辑设备号

- 链接指针: 设置分别指向空闲链表和散列队列的指针

## 文件操作

文件属于**抽象数据类型**。

操作系统提供了一系列**系统调用**来实现对文件的创建、删除、读、写、打开和关闭等操作。
