#include <pthread.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>


// Book structure definition.
struct Book {
    char name[50];
    char author[50];
    int total;
    int available;
};

// Read-write lock for synchronizing access to the books array.
static pthread_rwlock_t rwlock = PTHREAD_RWLOCK_INITIALIZER;

// Sample book data.
static struct Book books[7] = {
    {"The C Programming Language", "Brian W. Kernighan", 5, 3},
    {"Introduction to Algorithms", "Thomas H. Cormen", 4, 2},
    {"Computer Networks", "Andrew S. Tanenbaum", 6, 3},
    {"Operating System Concepts", "Abraham Silberschatz", 3, 2},
    {"Database System Concepts", "Abraham Silberschatz", 4, 2},
    {"Artificial Intelligence: A Modern Approach", "Stuart Russell", 2, 2},
    {"Computer Architecture", "John L. Hennessy", 5, 2},
};

// Buffer for inter-process communication.
static char buffer[100];
// Pipe file descriptors.
static int pipe_fd[2];

// Print single book information.
void print_book_info(struct Book books, int pattern);

// Print total book information.
void total_info(struct Book books[], int total_count);

// Get a random index within the integer parameter `total`.
int get_random_index(int total);

// The thread generated by child process.
void* search_thread(void* arg);

// The thread generated by child process.
void* borrow_thread(void* arg);

// Thread function for searching a book randomly, use for printing information.
void* search(char* book_name);

// Thread function for borrowing, judging whether the borrow thread can be carried out, and printing info the same as above.
void* borrow(char* book_name);
